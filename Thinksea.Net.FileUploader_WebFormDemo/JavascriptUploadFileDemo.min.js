var JavascriptUploadFileDemo;(function(n){function t(n,i){return i===void 0&&(i="0.##"),n>=t.FileLengthEB?(n*1/t.FileLengthEB).format(i)+" EB":n>=t.FileLengthPB?(n*1/t.FileLengthPB).format(i)+" PB":n>=t.FileLengthTB?(n*1/t.FileLengthTB).format(i)+" TB":n>=t.FileLengthGB?(n*1/t.FileLengthGB).format(i)+" GB":n>=t.FileLengthMB?(n*1/t.FileLengthMB).format(i)+" MB":n>=t.FileLengthKB?(n*1/t.FileLengthKB).format(i)+" KB":n+" B"}function e(n){var t="";switch(n){case".ico":t="ico";break;case".bmp":t="bmp";break;case".gif":t="gif";break;case".jpg":case".jpeg":case".jpe":t="jpg";break;case".png":t="png";break;case".svgz":case".svg":t="svg";break;case".mp4":case".webm":case".ogv":case".rm":case".rmvb":case".mpg":case".mpeg":case".mpeg4":case".avi":case".wmv":case".mov":case".mkv":case".3gp":case".flv":case".f4v":t="video";break;case".flac":case".ape":case".mp3":case".wma":case".wav":t="audio";break;case".zip":t="zip";break;case".rar":t="rar";break;case".7z":t="_7zip";break;case".ai":t="ai";break;case".browser":t="browser";break;case".iso":t="cd";break;case".bat":case".cmd":t="cmd";break;case".css":t="css";break;case".eml":t="email";break;case".emf":t="emf";break;case".doc":case".docx":case".wps":t="word";break;case".xls":case".xlsx":case".et":t="excel";break;case".ppt":case".pptx":case".dps":t="ppt";break;case".exe":t="exe";break;case".fla":t="flash";break;case".font":t="font";break;case".help":t="help";break;case".js":t="js";break;case".pdf":t="pdf";break;case".psd":t="psd";break;case".raw":t="raw";break;case".rtf":t="rtf";break;case".swf":t="swf";break;case".tif":t="tif";break;case".txt":t="txt";break;case".wmf":t="wmf";break;default:t="system"}return"filetypes "+t}function i(n){n.classList.contains("uploadItem")&&(n=n.parentElement);var t=n.querySelector(".uploadItem[data-uploadstate='wait']");t&&r(t.file,t)}function o(n){var t=document.getElementById(n.CustomParameter);t.setAttribute("data-begin_upload_time",(new Date).toString());t.setAttribute("data-start_position",n.StartPosition.toString())}function s(n){var r=document.getElementById(n.CustomParameter),u=r.querySelector("progress"),s,a,v,y,p,f,w,b,c,k,o,l,g;u&&(s=void 0,n.FileLength===0?(s=100,u.value=0):(s=n.FinishedSize*100/n.FileLength,u.value=Math.round(n.FinishedSize*1/n.FileLength*u.max)),a=u.querySelector(".ie"),a&&(a.style.width=Math.round(s)+"%"));var e="",nt=new Date,tt=new Date(r.getAttribute("data-begin_upload_time")),it=parseInt(r.getAttribute("data-start_position")),rt=(nt.getTime()-tt.getTime())/1e3,ut=n.FinishedSize-it,ft=ut/rt,h=n.FileLength/ft,d=Math.floor(h/86400),et=Math.floor(h%86400/3600),ot=Math.floor(h%3600/60),st=Math.ceil(h%60);if(d>0&&(e+=d.format("0")+"."),e+=et.format("00")+":",e+=ot.format("00")+":",e+=st.format("00"),v=r.querySelector(".fileSize"),v&&(v.innerText=Math.round(n.FinishedSize*1/n.FileLength*100)+"%,剩余时间:"+e),n.FinishedSize==n.FileLength&&(y=n.ResultData,u.style.display="none",p=r.querySelector(".fileUpload"),p&&(p.value=""),r.setAttribute("data-uploadstate","success"),f=r.querySelector(".uploadState"),f&&(f.innerText=y.IsFastUpload?"秒传完成":"上传完成",f.style.color="green",f.removeAttribute("title"),f.style.removeProperty("display")),r.classList.contains("uploadItem"))){if(w=y,b=r.querySelector(".fileSize"),b&&(b.innerText=t(w.FileLength,"0.#")),r.setAttribute("data-savepath",w.SavePath),c=r.parentElement.parentElement,c.id==="ctl5"){for(k=c.querySelectorAll(".uploadItem[data-uploadstate='success']"),o="",l=0;l<k.length;l++)o.length>0&&(o+=";"),o+=k[l].getAttribute("data-savepath");g=c.querySelector("input[name='fileUrls']");g.value=o}i(r)}}function h(n){var t=document.getElementById(n.CustomParameter),e=t.querySelector("progress"),u,f,r;e&&(e.style.display="none");u=t.querySelector(".fileSize");u&&(u.style.display="none");f=t.querySelector(".fileUpload");f&&(f.value="");t.setAttribute("data-uploadstate","error");r=t.querySelector(".uploadState");r&&(r.innerText="上传出错！",r.style.color="red",r.setAttribute("title",n.Message),r.style.removeProperty("display"));t.classList.contains("uploadItem")&&i(t)}function c(n){var t=document.getElementById(n.CustomParameter),e=t.querySelector("progress"),u,f,r;e&&(e.style.display="none");u=t.querySelector(".fileSize");u&&(u.style.display="none");f=t.querySelector(".fileUpload");f&&(f.value="");t.setAttribute("data-uploadstate","abort");r=t.querySelector(".uploadState");r&&(r.innerText="操作取消！",r.style.color="darkgray",r.style.removeProperty("display"));t.classList.contains("uploadItem")&&i(t)}function r(n,t){var u=t.querySelector("progress"),r,i;u&&u.style.removeProperty("display");r=t.querySelector(".fileSize");r&&(r.innerText="正在上传…",r.style.removeProperty("display"));i=new Thinksea.Net.FileUploader.HttpFileUpload;i.uploadServiceUrl="/HttpUploadHandler.ashx";i.beginUpload=o;i.uploadProgressChanged=s;i.errorOccurred=h;i.onabort=c;t.uploader=i;i.startUpload(n,t.id)}function u(n,t){var u,o,v,l,f,s,h,a,c;if(n.preventDefault&&n.preventDefault(),u=n.dataTransfer&&n.dataTransfer.files||n.originalEvent&&n.originalEvent.dataTransfer.files||n.files,u&&u.length>0)if(t.id==="ctl5"){if(o=t.querySelector(".fileinsertmark"),o===null){alert("ERROR：未找到文件插入标记元素。");return}for(v=t.id,l=0,f=0;f<u.length;f++){s=u[f];h=void 0;do h=v+"_file"+l.toString(),l++;while(t.querySelector("#"+h)!==null);a=document.createElement("div");a.innerHTML='<div id="'+h+'" class="uploadItem thumbnail pull-left" style="position: relative; width: 350px; margin: 5px;" data-uploadstate="wait">    <div class="uploadThumbnail pull-left '+e(s.name.getExtensionName().toLowerCase())+'" style="width: 32px; height: 32px; margin:3px 5px 3px 3px;"><\/div>    <div class="pull-left">        <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 240px;" title="'+htmlEncode(s.name)+'">'+htmlEncode(s.name)+'<\/div>        <progress max="100" class="progress progress-striped active progress-success" style="margin-bottom: unset; height: 10px; width: 80px; margin-top: 5px;">            <span class="ie" style="display: block; height: 10px;"><\/span>        <\/progress>        <span class="fileSize" style="color: darkgray;">待上传，请稍后…<\/span>        <span class="uploadState" style="display: none;"><\/span>    <\/div>    <button type="button" class="deleteButton btn btn-link pull-right">删除<\/button><\/div>';c=a.firstElementChild;c.querySelector(".deleteButton").onclick=function(){var n=this.parentElement,t=n.uploader,r;t&&t.cancelUpload();r=n.parentElement;n.remove();i(r)};o.parentElement.insertBefore(c,o);c.file=u[f]}i(t)}else r(u[0],t)}function f(n){for(var r,i=n.querySelectorAll(".fileUpload"),t=0;t<i.length;t++)r=i[t],r.onchange=function(){u(this,n)};for(i=n.querySelectorAll("[data-clickupload='true']"),t=0;t<i.length;t++)r=i[t],r.onclick=function(){var t=n.querySelector(".fileUpload");t.click()};for(i=n.querySelectorAll("[data-dragoverupload='true']"),t=0;t<i.length;t++)r=i[t],r.ondragover=function(n){n.preventDefault()},r.ondrop=function(t){u(t,n)}}function l(){for(var i,t=document.forms,n=0;n<t.length;n++)if(i=t[n],!i.checkValidity())return!1;return!0}function a(){document.body.ondragover=function(n){n.preventDefault()};document.body.ondrop=function(n){n.preventDefault()};f(document.getElementById("ctl5"));document.forms.length>0&&(document.forms[0].onsubmit=function(){return l()})}(function(n){n.FileLengthB=1;n.FileLengthKB=n.FileLengthB*1024;n.FileLengthMB=n.FileLengthKB*1024;n.FileLengthGB=n.FileLengthMB*1024;n.FileLengthTB=n.FileLengthGB*1024;n.FileLengthPB=n.FileLengthTB*1024;n.FileLengthEB=n.FileLengthPB*1024})(t||(t={}));n.initUploadControl=f;n.init=a})(JavascriptUploadFileDemo||(JavascriptUploadFileDemo={}));